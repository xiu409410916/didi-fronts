(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["common/main"],{"0d69":function(e,n,t){"use strict";t.r(n);var o=t("6752");for(var a in o)"default"!==a&&function(e){t.d(n,e,function(){return o[e]})}(a);t("3079");var c,i,s=t("2877"),r=Object(s["a"])(o["default"],c,i,!1,null,null,null);n["default"]=r.exports},3079:function(e,n,t){"use strict";var o=t("c3ac"),a=t.n(o);a.a},6752:function(e,n,t){"use strict";t.r(n);var o=t("90fe"),a=t.n(o);for(var c in o)"default"!==c&&function(e){t.d(n,e,function(){return o[e]})}(c);n["default"]=a.a},"90fe":function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=t("100a"),a={globalData:{socket:""},onLaunch:function(n){var t=decodeURIComponent(n.scene);console.log("App Launch"),console.log("scene-----------"+t);var o=this;e.login({provider:"weixin",success:function(e){var n=e.code;o.loginByCode(n,t)}});var a=[];if(!e.getStorageSync("messageList")){a=[];e.setStorageSync("messageList",a)}},onShow:function(){var n=this;console.log("App Show"),e.removeStorageSync("updateCart"),this.getHistoryMessage(),this.interval=setInterval(function(){n.checkOuttimeMsg()},1e4)},onHide:function(){console.log("App Hide"),clearInterval(this.interval)},methods:{checkOuttimeMsg:function(){var n=e.getStorageSync("messageList");if(null!=n&&n.length>0){for(var t=0;t<n.length;t++){var o=n[t];"0"==o.over&&null!=o.endTime&&""!=o.endTime&&new Date(o.endTime)>new Date&&(o.over,n[t]=o)}e.setStorageSync("messageList",n)}},getHistoryMessage:function(){var n=this,t=e.getStorageSync("patientInfo");null!=t&&(e.showToast({icon:"none",title:"加载消息中...",mask:!0}),this.$util.request({url:"/didi-patient/message/getUserUnreadedMessage",param:{userId:t.openId},contentType:"application/x-www-form-urlencoded",success:function(e){var t=e.data;if(null!=t&&t.length>0)for(var o=0;o<t.length;o++){var a=t[o];console.log(a),n.$util.updateMessage(a,"0")}},error:function(){}}))},loginByCode:function(n,t){var o=this,a={};a.code=n,a.scene=t,o.$util.request({url:"/didi-patient/ex/login_by_weixin",param:a,contentType:"application/x-www-form-urlencoded",success:function(n){e.setStorageSync("Token",n.data.openId),e.setStorageSync("patientInfo",n.data),o.connectMsgServer(n.data)},error:function(){}})},connectMsgServer:function(n){var t=this,a=n.openId,c="https://ws.dididoctor.cn?token="+a,i=o.connect(c);getApp().globalData.socket=i,i.on("connect",function(){console.log("系统通知: "+a+"成功连接至websocket服务器")}),i.on("disconnect",function(){console.log("系统通知: "+a+"已从websocket服务器断开连接")}),i.on("chat",function(n){var o=n;t.$util.updateMessage(o,"0"),e.vibrateLong(),console.log("系统通知: 收到来自"+n.username+"的悄悄话:"+n.msg.content)})}}};n.default=a}).call(this,t("543d")["default"])},c3ac:function(e,n,t){}},[["b43f","common/runtime","common/vendor"]]]);